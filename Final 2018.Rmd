---
title: "Final 2018"
author: "Maria Schweer-Collins"
date: "October 17, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Nhanes 2015-2016 instructions

The code chunk below explains the nhanes and the other packages that are needed and how to load the data.

``` {r nhanes data, echo = FALSE}

# install.packages("nhanesA")

library(nhanesA)
library(tidyverse)
library(rio)
library(here)
library(janitor)
theme_set(theme_classic())
```
The nhanesA package lets you import data directly from the CDC website on nhanes data. The code below will import data and I have created an object for it to be loaded to.

Below are examples of data from the 2015-2016 datasets.

You can also view the data but be prepared for your computer to take a while since it takes so long to download all the data.

It might be best to just view the data on the [nhanes website](https://wwwn.cdc.gov/Nchs/Nhanes/2015-2016/PAQ_I.htm) and then create an object with the specific variables we want to look at.

** Note: We could also look at visuals between the years since many of these variables reappear throughout all the years. **

[nhanes datasets by different years](https://wwwn.cdc.gov/nchs/nhanes/Default.aspx)

``` {r load_data, echo = TRUE, eval = FALSE}

# drug use dataset from 2015-2016
duq_i <- nhanes('DUQ_I')

# Demographics measures from 2015-2016
demo_i <- nhanes('DEMO_I')

# Depression measure
dpq_i <- nhanes('DPQ_I')

# Mental health services measure
huq_i <- nhanes('HUQ_I')

# Health insurance measure
hiq_i <- nhanes('HIQ_I')


# Example of exporting data into csv files
write.csv(duq_i, "duq_i.csv")
write.csv(demo_i, "demo_i.csv")
write.csv(dpq_i, "dpq_i.csv")
write.csv(huq_i, "huq_i.csv")
write.csv(hiq_i, "hiq_i.csv")

```

```{r import_data}
# Loading CSV files
duq_i <- import(here("data", "duq_i.csv"), 
                setclass = "tbl_df")
demo_i <- import(here("data", "demo_i.csv"),
                setclass = "tbl_df")
dpq_i <- import(here("data", "dpq_i.csv"),
                setclass = "tbl_df")
huq_i <- import(here("data", "huq_i.csv"),
                setclass = "tbl_df")
hiq_i <- import(here("data", "hiq_i.csv"),
                setclass = "tbl_df")

#merge files
d <- merge(duq_i,demo_i, by = "V1")
d1 <- merge(dpq_i, huq_i, by = "V1")
d2 <- merge(d, d1, by = "V1") 
fd <- merge(d2, hiq_i, by = "V1") # fd stands for final data

View(fd)
            
# Clean variables - DOESNT WORK YETTTTT!!!!!!
#fd%>% 
  #clean_names()
```

```{r tidy}

# Select columns (variables)
td <-  fd %>% 
  select(V1,DPQ010, DPQ020, DPQ030, DPQ040, DPQ050, DPQ060, DPQ070, DPQ080, DPQ090, DPQ100, RIDRETH3, RIAGENDR, DMDEDUC2, INDHHIN2, RIDAGEYR, DUQ260, DUQ300, DUQ340, DUQ430, DUQ210, HIQ011, HUQ090)

View(td)
  
# Evaluation of missing data

td_without_missing <- na.omit(td) # if missing data is removed, we would just have a sample of 17 people. When doing calculation, we will use the na.rm = TRUE. 

View(td_without_missing) 

# The DUQ variables are mostly missing data, I don't know if it makes sense to use variables. 

# Computing depression total score

td <-td %>%
  group_by(V1) %>%
  mutate(sum_depression = sum(DPQ010+ DPQ020+ DPQ030+DPQ040+ DPQ050+ DPQ060+ DPQ070+ DPQ080 + DPQ090, 
                              na.rm=TRUE))
# Computing stimulant composite
 td <- td %>% 
   mutate(age_stim = mean(DUQ260 + DUQ340, na.rm = TRUE)) %>% 
 

# Labels for categorical variables
td %>% 
  mutate(RIDRETH3 = factor(RIDRETH3)) %>% 
  mutate(case_when(RIDRETH3 == 1 ~ "Mexican American", 
                 RIDRETH3 == 2 ~ "Other Hispanic", 
                 RIDRETH3 == 3 ~ "Non-Hispanic White",
                 RIDRETH3 == 4 ~ "Non-Hispanic Black",
                 RIDRETH3 == 6 ~ "Non-Hispanic Asian",
                 RIDRETH3 == 7 ~ "Other Race - Including Multi-Racial",
                 TRUE ~ na_character_))
 
```

```{r exploratory_visuals}
#Maria's visualization 

#prepare data

gender <- as.factor(td$RIAGENDR)

#Create boxplot of total depression scores by gender

plot1 <- ggplot(td, aes(gender, sum_depression))
plot1 + geom_boxplot(varwidth=T, fill="plum") + 
    labs(title="Box plot", 
         subtitle="Total Depression Score by Gender",
         caption="Source: NHANES",
         x="Gender",
         y="Total Depression Score")

```








